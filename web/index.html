<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Job Hunter Crew</title>
  <link rel="stylesheet" href="/assets/app.css" />
</head>

<body>
  <div class="topbar">
    <div class="topbar__inner">
      <div class="brand">
        <div class="brand__mark">JH</div>
        <div>
          <div class="brand__title">Job Hunter Crew</div>
          <div class="brand__subtitle">Scraping + IA + ranking de adecuaci√≥n</div>
        </div>
      </div>

      <div class="topbar__status">
        <div class="pill">
          <span class="dot dot--muted" id="backendDot"></span>
          <span id="backendLabel">Backend: desconocido</span>
        </div>
        <div class="pill">
          <span class="dot dot--muted" id="wsDot"></span>
          <span id="wsLabel">WS: desconectado</span>
        </div>
      </div>
    </div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <div class="tabs">
        <button class="tab tab--active" data-tab="search">B√∫squeda</button>
        <button class="tab" data-tab="logs">Logs</button>
        <button class="tab" data-tab="results">Resultados</button>
      </div>

      <div class="panel panel--compact">
        <div class="panel__title">Acciones</div>
        <div class="panel__body">
          <div class="actions">
            <button class="btn" id="btnStart">‚ñ∂ Iniciar</button>
            <button class="btn btn--secondary" id="btnClear">Limpiar</button>
            <!-- NUEVO BOT√ìN EXPORTAR -->
            <button class="btn btn--secondary" id="btnExport">üíæ Exportar CSV</button>
            
            <button class="btn btn--secondary" id="btnPing">Ping</button>
            <button class="btn btn--secondary" id="btnReconnectWs">Reconectar WS</button>
          </div>

          <div class="divider"></div>

          <div class="summary">
            <div class="summary__row"><span class="muted">Resultados</span><span id="summaryJobs" class="mono">0</span></div>
            <div class="summary__row"><span class="muted">Logs</span><span id="summaryLogs" class="mono">0</span></div>
            <div class="summary__row"><span class="muted">√öltimo evento</span><span id="summaryEvent" class="mono">‚Äî</span></div>
          </div>
        </div>
      </div>
    </aside>

    <main class="content">
      <!-- VIEW: SEARCH -->
      <section class="view view--active" id="view-search">
        <div class="card">
          <div class="card__header">
            <div>
              <div class="card__title">Criterios de b√∫squeda</div>
              <div class="card__subtitle">Define keywords, experiencia y adjunta CV si lo deseas.</div>
            </div>
            <div class="card__headerActions">
              <button class="btn btn--secondary" id="btnRefreshModels">Actualizar modelos</button>
            </div>
          </div>

          <div class="card__body">
            <div class="grid2">
              <div class="field">
                <label>Keywords</label>
                <input id="keywords" placeholder="rust, backend, security, llm, neo4j" />
                <div class="hint">Separadas por coma. Se usar√°n para scraping y scoring.</div>
              </div>

              <div class="field">
                <label>Experiencia</label>
                <select id="experience">
                  <option value="entry">Entry</option>
                  <option value="junior">Junior</option>
                  <option value="mid" selected>Mid</option>
                  <option value="senior">Senior</option>
                  <option value="lead">Lead</option>
                  <option value="any">Any</option>
                </select>
                <div class="hint">Ajusta el perfil objetivo para filtrar y priorizar.</div>
              </div>

              <div class="field field--full">
                <label>CV (PDF/TXT)</label>
                <div class="fileRow">
                  <input id="cvFile" type="file" accept=".pdf,.txt" />
                  <button class="btn btn--secondary" id="btnUploadCv">Cargar y Analizar CV</button>
                </div>
                <!-- Estado de carga visual -->
                <div class="hint" id="cvStatus">Selecciona un archivo y pulsa "Cargar".</div>
              </div>

              <div class="field field--full">
                <label>CV (texto extra√≠do)</label>
                <textarea id="cvText" placeholder="El texto del CV aparecer√° aqu√≠..."></textarea>
                
                <div id="cvKeywordsArea" style="display:none; margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                  <div class="small muted" style="margin-bottom: 8px; font-weight:bold;">Sugerencias detectadas por IA (clic para a√±adir):</div>
                  <div class="chips" id="cvKeywordsChips" style="display:flex; flex-wrap:wrap; gap:6px;"></div>
                </div>
              </div>
            </div>

            <div class="divider"></div>

            <!-- CONFIGURACI√ìN DE EJECUCI√ìN (NUEVO) -->
            <div class="field field--full">
              <label>Configuraci√≥n de Ejecuci√≥n (Scrapers)</label>
              <div class="grid2" style="background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; border: 1px solid var(--border);">
                <div class="field">
                  <label>Delay entre Peticiones (ms)</label>
                  <input type="number" id="globalDelay" value="1200" min="500" step="100" />
                  <div class="hint">Tiempo de espera para evitar bloqueos (Anti-Bot). Valor recomendado: 1200ms.</div>
                </div>
                <div class="field">
                  <label>Comportamiento</label>
                  <div class="hint" style="margin-top: 6px;">
                    El backend intentar√° obtener hasta 15 ofertas por fuente. Aumentar el delay reduce el riesgo de bloqueo pero hace la b√∫squeda m√°s lenta.
                  </div>
                </div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="grid2">
              <div class="field">
                <label>Proveedor LLM</label>
                <select id="llmProvider">
                  <option value="local" selected>Ollama (Local)</option>
                  <option value="openai">OpenAI</option>
                  <option value="anthropic">Anthropic</option>
                </select>
                <div class="hint">‚ÄúActualizar modelos‚Äù rellena los desplegables.</div>
              </div>

              <div class="field" id="fieldUseCase">
                <label>Caso de uso</label>
                <select id="llmUseCase">
                  <option value="fast">fast</option>
                  <option value="balanced" selected>balanced</option>
                  <option value="deep">deep</option>
                  <option value="long_context">long_context</option>
                </select>
                <div class="hint">Afecta al selector autom√°tico de modelos en cloud.</div>
              </div>

              <div class="field" id="fieldLocalEndpoint">
                <label>Endpoint Ollama</label>
                <input id="localEndpoint" value="http://localhost:11434" />
              </div>

              <div class="field" id="fieldLocalModel">
                <label>Modelo Ollama</label>
                <select id="localModel"></select>
              </div>

              <div class="field" id="fieldApiKey" style="display:none;">
                <label>API Key (cloud)</label>
                <input id="apiKey" type="password" placeholder="sk-..." />
              </div>

              <div class="field" id="fieldBaseUrl" style="display:none;">
                <label>Base URL (opcional)</label>
                <input id="cloudBaseUrl" placeholder="https://api.openai.com o https://api.anthropic.com" />
                <div class="hint">Deja vac√≠o para usar el default del proveedor.</div>
              </div>

              <div class="field field--full" id="fieldCloudModel" style="display:none;">
                <label>Modelo (cloud)</label>
                <select id="cloudModel">
                  <option value="auto" selected>auto</option>
                </select>
                <div class="hint" id="cloudModelHint">Pulsa ‚ÄúActualizar modelos‚Äù.</div>
                <div class="hint" id="cloudError" style="display:none;"></div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="field field--full">
              <label>Fuentes (scrapers)</label>
              <div class="sources" id="sources"></div>
              <div class="hint">Activa/desactiva fuentes. (Proxy si tu backend lo soporta.)</div>
            </div>
          </div>

          <div class="card__footer">
            <div class="small muted">Los resultados llegar√°n por WebSocket y se renderizar√°n al vuelo.</div>
            <div class="actions">
              <button class="btn" id="btnStartBottom">‚ñ∂ Iniciar</button>
              <button class="btn btn--secondary" id="btnClearBottom">Limpiar</button>
            </div>
          </div>
        </div>
      </section>

      <!-- VIEW: LOGS -->
      <section class="view" id="view-logs">
        <div class="card">
          <div class="card__header">
            <div>
              <div class="card__title">Logs</div>
              <div class="card__subtitle">Streaming del backend v√≠a WebSocket.</div>
            </div>
          </div>
          <div class="card__body">
            <div class="logs" id="logs"></div>
          </div>
        </div>
      </section>

      <!-- VIEW: RESULTS -->
      <section class="view" id="view-results">
        <div class="card">
          <div class="card__header">
            <div>
              <div class="card__title">Resultados</div>
              <div class="card__subtitle">Cards actualizadas en vivo por URL (job_analyzed / job_found).</div>
            </div>
            <div class="card__headerActions">
                <button class="btn btn--secondary" onclick="document.getElementById('btnExport').click()">üíæ Exportar CSV</button>
            </div>
          </div>
          <div class="card__body">
            <div class="jobs" id="jobs">
              <div class="emptyState" id="emptyState">A√∫n no hay resultados. Inicia una b√∫squeda para ver ofertas aqu√≠.</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="toasts" id="toasts"></div>

  <script type="module" src="/assets/app.js"></script>
</body>
</html>




